// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  RECRUITER
  CANDIDATE
}

enum JobStatus {
  OPEN
  CLOSED
}

enum ApplicationStatus {
  PENDING
  VIEWED
  SHORTLISTED
  REJECTED
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password_hash String
  role          Role     @default(CANDIDATE)
  created_at    DateTime @default(now())

  candidateProfile CandidateProfile?
  recruiterProfile RecruiterProfile?
  jobs             Job[]
  applications     Application[]
}

model CandidateProfile {
  id         String  @id @default(cuid())
  user_id    String  @unique
  phone      String?
  photo_url  String?
  resume_url String?
  user       User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model RecruiterProfile {
  id            String  @id @default(cuid())
  user_id       String  @unique
  company_name  String
  company_email String
  description   String?
  user          User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Job {
  id           String    @id @default(cuid())
  title        String
  description  String
  location     String
  salary       String?
  job_type     String?   // Full-time, Part-time, Contract, etc.
  experience   String?   // Experience required
  skills       String[]  // Skills required
  recruiter_id String
  status       JobStatus @default(OPEN)
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  recruiter    User          @relation(fields: [recruiter_id], references: [id], onDelete: Cascade)
  applications Application[]
}

model Application {
  id           String            @id @default(cuid())
  job_id       String
  candidate_id String
  resume_url   String
  cover_letter String?
  status       ApplicationStatus @default(PENDING)
  applied_at   DateTime          @default(now())

  job       Job  @relation(fields: [job_id], references: [id], onDelete: Cascade)
  candidate User @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@unique([job_id, candidate_id])
}
